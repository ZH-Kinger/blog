import{_ as p}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as u,a as l,b as s,d as r,w as o,e,f as t,r as i,o as b}from"./app-BLdkw27Y.js";const g={},f={href:"https://www.baidu.com",target:"_blank",rel:"noopener noreferrer"},k={id:"日志收集平台",tabindex:"-1"},m={class:"header-anchor",href:"#日志收集平台"},y={id:"一、kraft-元数据管理的核心架构",tabindex:"-1"},v={class:"header-anchor",href:"#一、kraft-元数据管理的核心架构"},x={id:"_1-架构转型-从-zk-单控制器到-raft-控制器集群",tabindex:"-1"},F={class:"header-anchor",href:"#_1-架构转型-从-zk-单控制器到-raft-控制器集群"},A={id:"_2-核心组件分工",tabindex:"-1"},S={class:"header-anchor",href:"#_2-核心组件分工"},L={id:"二、kafka-消息存储机制-基于分区日志的高效设计",tabindex:"-1"},D={class:"header-anchor",href:"#二、kafka-消息存储机制-基于分区日志的高效设计"},c={id:"三、kafka-生产-消费核心流程",tabindex:"-1"},E={class:"header-anchor",href:"#三、kafka-生产-消费核心流程"},q={id:"_1-生产者发送消息流程",tabindex:"-1"},I={class:"header-anchor",href:"#_1-生产者发送消息流程"},P={id:"_2-消费者消费消息流程",tabindex:"-1"},C={class:"header-anchor",href:"#_2-消费者消费消息流程"},K={id:"四、kafka-高可用保障机制",tabindex:"-1"},T={class:"header-anchor",href:"#四、kafka-高可用保障机制"},R={id:"五、kafka-集群核心特性",tabindex:"-1"},N={class:"header-anchor",href:"#五、kafka-集群核心特性"},w={id:"卡夫卡流量日志监控平台",tabindex:"-1"},B={class:"header-anchor",href:"#卡夫卡流量日志监控平台"},z={id:"查看本地域名解析地址-将虚拟机ip和nameserver写入-etc-networkmanager-system-connections-ens33-nmconnection下的addressesl-dns设置为默认的114-114-114-114。",tabindex:"-1"},M={class:"header-anchor",href:"#查看本地域名解析地址-将虚拟机ip和nameserver写入-etc-networkmanager-system-connections-ens33-nmconnection下的addressesl-dns设置为默认的114-114-114-114。"};function O(j,n){const a=i("font"),d=i("VPIcon");return b(),u("div",null,[n[327]||(n[327]=l("p",null,"4c",-1)),l("p",null,[n[2]||(n[2]=s(":::tips",-1)),n[3]||(n[3]=l("br",null,null,-1)),n[4]||(n[4]=s(' Apache Kafka（常被称为 "卡夫卡"）是**',-1)),r(a,{style:{color:"rgb(31, 35, 41)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[0]||(n[0]=[s("Apache 软件基金会",-1)])]),_:1}),n[5]||(n[5]=l("strong",null,"的开源分布式流处理平台，最初由 LinkedIn 开发，2011 年捐赠给 Apache 并成为顶级项目，名称取自捷克小说家弗兰兹・卡夫卡（Franz Kafka）。它本质上是一个",-1)),r(a,{style:{color:"rgb(31, 35, 41)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[1]||(n[1]=[s("分布式、分区化、多副本的日志提交服务",-1)])]),_:1}),n[6]||(n[6]=s('**，核心定位是 "高吞吐量的分布式发布 - 订阅消息系统"，同时兼具流处理平台的能力。',-1))]),n[328]||(n[328]=l("p",null,":::",-1)),n[329]||(n[329]=l("figure",null,[l("img",{src:"https://cdn.nlark.com/yuque/0/2026/jpeg/62301513/1768190486327-e5da738b-7a03-4e14-97f5-3e117ff64b2a.jpeg",alt:"画板",tabindex:"0",loading:"lazy"}),l("figcaption",null,"画板")],-1)),e(" 这是一张图片，ocr 内容为： "),n[330]||(n[330]=l("figure",null,[l("img",{src:"https://cdn.nlark.com/yuque/0/2026/png/62301513/1768199620419-ffc1dcf0-3472-4799-b41c-17ea31dcfbf2.png",alt:"",tabindex:"0",loading:"lazy"}),l("figcaption")],-1)),n[331]||(n[331]=l("h2",{id:"查看网卡信息ip-a",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#查看网卡信息ip-a"},[l("span",null,"查看网卡信息 ip a")])],-1)),l("p",null,[n[8]||(n[8]=s("[root@wang ~]# ",-1)),l("strong",null,[r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[7]||(n[7]=[s("ip a",-1)])]),_:1})]),n[9]||(n[9]=l("br",null,null,-1)),n[10]||(n[10]=s(" 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000",-1)),n[11]||(n[11]=l("br",null,null,-1)),n[12]||(n[12]=s(" link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00",-1)),n[13]||(n[13]=l("br",null,null,-1)),n[14]||(n[14]=s(" inet 127.0.0.1/8 scope host lo",-1)),n[15]||(n[15]=l("br",null,null,-1)),n[16]||(n[16]=s(" valid_lft forever preferred_lft forever",-1)),n[17]||(n[17]=l("br",null,null,-1)),n[18]||(n[18]=s(" inet6 ",-1)),r(d,{icon:`1/128 scope host noprefixroute   
       valid_lft forever preferred_lft forever  
2: ens160: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000  
    link/ether 00:0c:29:40:a3:a8 brd ff:ff:ff:ff:ff:ff  
    altname enp3s0  
    altname enx000c2940a3a8  
    inet 192.168.245.130/24 brd 192.168.245.255 scope global dynamic noprefixroute ens160  
       valid_lft 1746sec preferred_lft 1746sec  
    inet6 fe80`}),n[19]||(n[19]=s("20c:29ff:fe40:a3a8/64 scope link noprefixroute",-1)),n[20]||(n[20]=l("br",null,null,-1)),n[21]||(n[21]=s(" valid_lft forever preferred_lft forever",-1))]),n[332]||(n[332]=t('<h3 id="_1-127-0-0-1-8-——-本地回环地址" tabindex="-1"><a class="header-anchor" href="#_1-127-0-0-1-8-——-本地回环地址"><span>1. <code>127.0.0.1/8</code> —— 本地回环地址</span></a></h3><ul><li><strong>所属接口</strong>：<code>lo</code>（loopback，回环接口）</li><li><strong>核心含义</strong>：这是<strong>本机内部通信的虚拟地址</strong>，不对应任何物理网卡，数据不会经过网线或网卡传输，只在操作系统内核内部流转。</li><li><strong>典型用途</strong><ul><li>测试本地运行的服务（比如你在本机启动了 Spring Boot 项目，用 <code>127.0.0.1:8080</code> 就能访问）。</li><li>进程间通信（本机内的不同程序通过这个地址交互，无需走网络）。</li><li>验证网络协议栈是否正常（<code>ping 127.0.0.1</code> 能通说明 TCP/IP 协议栈没问题）。</li></ul></li><li><strong>补充</strong>：<code>inet6 ::1/128</code> 是 IPv6 版本的回环地址，作用和 <code>127.0.0.1</code> 一致。</li></ul><h3 id="_2-192-168-245-130-24-——-局域网-ip-地址" tabindex="-1"><a class="header-anchor" href="#_2-192-168-245-130-24-——-局域网-ip-地址"><span>2. <code>192.168.245.130/24</code> —— 局域网 IP 地址</span></a></h3><ul><li><strong>所属接口</strong>：<code>ens160</code>（物理网卡接口，不同服务器的命名可能不同，比如 <code>eth0</code>、<code>ens33</code> 等）</li><li><strong>核心含义</strong>：这是你的服务器在<strong>局域网内的唯一标识</strong>，由路由器或 DHCP 服务器分配（<code>dynamic</code> 表示是动态获取的），用于和局域网内的其他设备（比如同一网段的电脑、服务器）通信。</li><li><strong>关键参数说明</strong><ul><li><code>/24</code>：表示子网掩码是 <code>255.255.255.0</code>，这个网段的可用 IP 范围是 <code>192.168.245.1</code> ~ <code>192.168.245.254</code>。</li><li><code>dynamic</code>：表示该 IP 是通过 DHCP 动态获取的，重启网卡或设备后可能会变化；如果是 <code>static</code> 则是手动配置的固定 IP。</li></ul></li><li><strong>典型用途</strong><ul><li>局域网内设备互访（比如你用另一台电脑访问这个服务器上的 Kafka 或数据库）。</li><li>连接外网（通过路由器的 NAT 功能，借助这个 IP 访问互联网）。</li></ul></li></ul><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h3><table><thead><tr><th>IP 地址</th><th>接口</th><th>类型</th><th>作用范围</th><th>核心用途</th></tr></thead><tbody><tr><td><code>127.0.0.1/8</code></td><td><code>lo</code></td><td>回环地址</td><td>本机内部</td><td>本地服务测试、进程间通信</td></tr><tr><td><code>192.168.245.130/24</code></td><td><code>ens160</code></td><td>局域网地址</td><td>局域网 + 外网</td><td>设备间通信、访问互联网</td></tr></tbody></table><h2 id="dns-domain-name-server-域名服务" tabindex="-1"><a class="header-anchor" href="#dns-domain-name-server-域名服务"><span>DNS （domain name server 域名服务）</span></a></h2>',7)),l("p",null,[l("strong",null,[r(a,{style:{color:"rgb(31, 35, 41)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[22]||(n[22]=[s("DNS",-1)])]),_:1})]),n[25]||(n[25]=s("（Domain Name System，域名系统）是互联网的核心基础设施，",-1)),l("strong",null,[r(a,{style:{color:"rgb(31, 35, 41)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[23]||(n[23]=[s('相当于一本巨型的分布式 "电话簿"',-1)])]),_:1})]),n[26]||(n[26]=s("，负责将人类易记的域名（如",-1)),l("a",f,[r(a,{style:{color:"rgb(0, 87, 255)"}},{default:o(()=>[...n[24]||(n[24]=[s("www.baidu.com",-1)])]),_:1})]),n[27]||(n[27]=s("）转换为计算机可识别的 IP 地址（如 14.215.177.38），使网络通信成为可能。",-1))]),n[333]||(n[333]=l("p",null,"本地域名解析",-1)),n[334]||(n[334]=l("p",null,"1.看缓存",-1)),n[335]||(n[335]=l("p",null,"2.看/etc/hosts文件 本地域名映射文件",-1)),e(" 这是一张图片，ocr 内容为： "),n[336]||(n[336]=l("figure",null,[l("img",{src:"https://cdn.nlark.com/yuque/0/2026/png/62301513/1768632458834-b767737e-6598-4959-89ce-216b36a22929.png",alt:"",tabindex:"0",loading:"lazy"}),l("figcaption")],-1)),n[337]||(n[337]=l("p",null,"配置映射实现进程通信",-1)),n[338]||(n[338]=l("p",null,"3.请求本地域名解析服务器 /etc/resolv.conf",-1)),e(" 这是一张图片，ocr 内容为： "),n[339]||(n[339]=t(`<figure><img src="https://cdn.nlark.com/yuque/0/2026/png/62301513/1768632391859-11d0d459-a745-467e-a74e-53a2fecafab0.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>nameserver ： 声明 DNS 服务器的 IP 地址（最核心），可配置多个（最多 3 个，按优先级生效）</p><pre><code>                                         ****                                                                                                                                                        
</code></pre><h2 id="负载均衡" tabindex="-1"><a class="header-anchor" href="#负载均衡"><span>负载均衡</span></a></h2><h3 id="_1-dns解析实现负载均衡" tabindex="-1"><a class="header-anchor" href="#_1-dns解析实现负载均衡"><span>1.DNS解析实现负载均衡</span></a></h3>`,5)),l("p",null,[n[30]||(n[30]=s("DNS 解析实现负载均衡，是一种**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[28]||(n[28]=[s("基于域名系统的负载分发技术",-1)])]),_:1}),n[31]||(n[31]=l("strong",null,"，核心原理是：",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[29]||(n[29]=[s("同一个域名对应多个不同的服务器 IP 地址",-1)])]),_:1}),n[32]||(n[32]=s("**，DNS 服务器在接收到域名解析请求时，按照预设策略返回不同的 IP，将用户请求均匀分配到多台服务器上，从而实现负载分担、提高服务可用性。",-1))]),n[340]||(n[340]=l("h3",{id:"_2-各种反向代理",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#_2-各种反向代理"},[l("span",null,"2.各种反向代理")])],-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[33]||(n[33]=[s("一、反向代理的核心概念",-1)])]),_:1}),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[34]||(n[34]=[s("反向代理（Reverse Proxy）是 Nginx 最核心的功能之一：简单来说，",-1)])]),_:1}),n[341]||(n[341]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[35]||(n[35]=[s("客户端不直接访问后端服务器，而是先请求 Nginx 服务器，由 Nginx 代替客户端向后端服务器发起请求，再将后端的响应结果返回给客户端",-1)])]),_:1}),n[342]||(n[342]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[36]||(n[36]=[s("。",-1)])]),_:1}),l("ul",null,[l("li",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[37]||(n[37]=[s("正向代理",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[38]||(n[38]=[s("：替客户端（用户）向外部服务器请求（比如翻墙工具）；",-1)])]),_:1})]),l("li",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[39]||(n[39]=[s("反向代理",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[40]||(n[40]=[s("：替后端服务器接收客户端请求（对外只暴露 Nginx 地址，隐藏后端服务）。",-1)])]),_:1})])]),n[343]||(n[343]=l("h3",{id:"_3-ospf动态路由-根据cost-花费值选择",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#_3-ospf动态路由-根据cost-花费值选择"},[l("span",null,"3.ospf动态路由（根据cost：花费值选择）")])],-1)),l("p",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[41]||(n[41]=[s("OSPF（开放式最短路径优先）",-1)])]),_:1})]),n[44]||(n[44]=s(" 是一种基于 ",-1)),l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[42]||(n[42]=[s("链路状态",-1)])]),_:1})]),n[45]||(n[45]=s(" 的内部网关协议（IGP），其核心是通过**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[43]||(n[43]=[s("链路开销（Cost）",-1)])]),_:1}),n[46]||(n[46]=s("** 计算最短路径，实现动态路由选择。在搭建跨网段的日志监控系统（如多机房 ELK/Kafka 集群）时，OSPF 可以自动适配网络拓扑变化，保障日志数据传输的稳定性。",-1))]),n[344]||(n[344]=l("h3",{id:"_4-云原生",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#_4-云原生"},[l("span",null,"4.云原生")])],-1)),l("p",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[47]||(n[47]=[s("云原生（Cloud Native）",-1)])]),_:1})]),n[49]||(n[49]=s(" 是一套**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[48]||(n[48]=[s("构建和运行应用的方法论与技术体系",-1)])]),_:1}),n[50]||(n[50]=s("**，核心目标是让应用能够充分利用云计算的弹性、可扩展性和分布式特性，实现快速迭代、高效运维和故障自愈。",-1))]),n[345]||(n[345]=l("p",null,"基础设置建设",-1)),n[346]||(n[346]=l("h2",{id:"中台建设",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#中台建设"},[l("span",null,"中台建设")])],-1)),n[347]||(n[347]=l("h3",{id:"_1-dns管理",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#_1-dns管理"},[l("span",null,"1.DNS管理")])],-1)),l("p",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[51]||(n[51]=[s("DNS 管理",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[52]||(n[52]=[s("是指对",-1)])]),_:1}),l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[53]||(n[53]=[s("域名系统（Domain Name System）",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[54]||(n[54]=[s(" 的各类资源记录、解析策略、服务器配置进行规划、配置、监控和维护的一系列操作，核心目标是保障域名到 IP 地址解析的",-1)])]),_:1}),l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[55]||(n[55]=[s("准确性、稳定性和高效性",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[56]||(n[56]=[s("。",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[57]||(n[57]=[s("简单来说，DNS 管理就是让用户输入域名（如 ",-1)])]),_:1}),n[348]||(n[348]=s("`",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[58]||(n[58]=[s("kibana.example.com",-1)])]),_:1}),n[349]||(n[349]=s("`",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[59]||(n[59]=[s("）时，能快速、正确地找到对应的服务器 IP，同时满足业务的负载均衡、容灾、安全等需求。",-1)])]),_:1}),n[350]||(n[350]=l("h3",{id:"_2-配置管理",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#_2-配置管理"},[l("span",null,"2.配置管理")])],-1)),n[351]||(n[351]=l("h3",{id:"_3-流量切换",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#_3-流量切换"},[l("span",null,"3.流量切换")])],-1)),l("p",null,[n[62]||(n[62]=s("在 Kafka 中，",-1)),l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[60]||(n[60]=[s("流量切换",-1)])]),_:1})]),n[63]||(n[63]=s(" 是指将生产者 / 消费者的请求流量，从某一组 Broker、分区或 Topic，转移到其他目标节点的运维操作，核心目标是 ",-1)),l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[61]||(n[61]=[s("保障服务高可用、实现负载均衡、完成集群扩缩容或故障迁移",-1)])]),_:1})]),n[64]||(n[64]=s("。",-1))]),n[352]||(n[352]=l("h3",{id:"_4-ci-cd",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#_4-ci-cd"},[l("span",null,[l("a",{href:"http://4.CI/CD",target:"_blank",rel:"noopener noreferrer"},"4.CI/CD")])])],-1)),l("p",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[65]||(n[65]=[s("CI/CD",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[66]||(n[66]=[s(" 是 ",-1)])]),_:1}),l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[67]||(n[67]=[s("持续集成（Continuous Integration）",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[68]||(n[68]=[s(" 和 ",-1)])]),_:1}),l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[69]||(n[69]=[s("持续部署 / 交付（Continuous Deployment/Delivery）",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[70]||(n[70]=[s(" 的合称，是一套",-1)])]),_:1}),l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[71]||(n[71]=[s("自动化软件构建、测试、部署的流程体系",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[72]||(n[72]=[s("，核心目标是",-1)])]),_:1}),l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[73]||(n[73]=[s("缩短从代码提交到应用上线的周期",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[74]||(n[74]=[s("，降低人工操作成本和出错概率，同时提升迭代效率。",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[75]||(n[75]=[s("在你搭建的日志监控系统（ELK + Kafka + Filebeat + Python 消费端）中，CI/CD 可以自动化完成",-1)])]),_:1}),n[353]||(n[353]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[76]||(n[76]=[s("代码编译、镜像构建、配置更新、服务部署",-1)])]),_:1}),n[354]||(n[354]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[77]||(n[77]=[s("等工作，比如 Python 消费脚本的更新、Filebeat 配置的下发、Kibana 可视化面板的同步等。",-1)])]),_:1}),n[355]||(n[355]=l("h3",{id:"_5-日志管理",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#_5-日志管理"},[l("span",null,"5.日志管理")])],-1)),l("p",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[78]||(n[78]=[s("日志管理",-1)])]),_:1}),n[81]||(n[81]=l("strong",null,"是一套围绕",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[79]||(n[79]=[s("日志的采集、传输、存储、解析、检索、分析、可视化及归档清理",-1)])]),_:1}),n[82]||(n[82]=l("strong",null,"的全生命周期管理体系，核心目标是",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[80]||(n[80]=[s("保障日志数据的完整性、可用性和安全性",-1)])]),_:1})]),n[83]||(n[83]=s("，同时通过日志挖掘系统运行状态、定位故障、审计合规、优化业务。",-1))]),n[356]||(n[356]=l("h2",{id:"灰度",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#灰度"},[l("span",null,"灰度")])],-1)),r(a,{style:{color:"rgb(31, 35, 41)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[84]||(n[84]=[s("在云原生和软件发布领域，",-1)])]),_:1}),n[357]||(n[357]=s("**",-1)),r(a,{style:{color:"rgb(31, 35, 41)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[85]||(n[85]=[s("灰度",-1)])]),_:1}),n[358]||(n[358]=s("**",-1)),r(a,{style:{color:"rgb(31, 35, 41)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[86]||(n[86]=[s("通常指 ",-1)])]),_:1}),n[359]||(n[359]=s("**",-1)),r(a,{style:{color:"rgb(31, 35, 41)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[87]||(n[87]=[s("灰度发布",-1)])]),_:1}),n[360]||(n[360]=s("**",-1)),r(a,{style:{color:"rgb(31, 35, 41)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[88]||(n[88]=[s("（也叫金丝雀发布），是一种",-1)])]),_:1}),n[361]||(n[361]=s("**",-1)),r(a,{style:{color:"rgb(31, 35, 41)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[89]||(n[89]=[s("平滑过渡的版本迭代策略",-1)])]),_:1}),n[362]||(n[362]=s("**",-1)),r(a,{style:{color:"rgb(31, 35, 41)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[90]||(n[90]=[s("，核心目标是",-1)])]),_:1}),n[363]||(n[363]=s("**",-1)),r(a,{style:{color:"rgb(31, 35, 41)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[91]||(n[91]=[s("降低新版本上线的风险",-1)])]),_:1}),n[364]||(n[364]=s("**",-1)),r(a,{style:{color:"rgb(31, 35, 41)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[92]||(n[92]=[s("，避免全量发布时因潜在 bug 导致大规模服务故障。",-1)])]),_:1}),r(a,{style:{color:"rgb(31, 35, 41)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[93]||(n[93]=[s("简单来说，灰度发布不是一次性把所有用户流量切换到新版本，而是",-1)])]),_:1}),n[365]||(n[365]=s("**",-1)),r(a,{style:{color:"rgb(31, 35, 41)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[94]||(n[94]=[s("分批次、分范围",-1)])]),_:1}),n[366]||(n[366]=s("**",-1)),r(a,{style:{color:"rgb(31, 35, 41)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[95]||(n[95]=[s("地将流量导入新版本，验证没问题后再逐步扩大覆盖比例，最终实现全量切换。",-1)])]),_:1}),r(a,{style:{color:"rgb(31, 35, 41)","background-color":"rgba(0, 0, 0, 0)"}}),r(a,{style:{color:"rgb(31, 35, 41)","background-color":"rgba(0, 0, 0, 0)"}}),l("h1",k,[l("a",m,[l("span",null,[r(a,{style:{color:"rgb(31, 35, 41)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[96]||(n[96]=[s("日志收集平台",-1)])]),_:1})])])]),n[367]||(n[367]=l("p",null,"日志",-1)),n[368]||(n[368]=l("p",null,"1.错误定位，追责",-1)),n[369]||(n[369]=l("p",null,"2.用户行为分析",-1)),n[370]||(n[370]=l("figure",null,[l("img",{src:"https://cdn.nlark.com/yuque/0/2026/jpeg/62301513/1768206182594-5332137b-4aa5-4935-8f85-38b927b93401.jpeg",alt:"画板",tabindex:"0",loading:"lazy"}),l("figcaption",null,"画板")],-1)),e(" 这是一张图片，ocr 内容为： "),n[371]||(n[371]=l("figure",null,[l("img",{src:"https://cdn.nlark.com/yuque/0/2026/jpeg/62301513/1768206496384-714b60be-8753-417a-9347-add4ab7765b9.jpeg",alt:"",tabindex:"0",loading:"lazy"}),l("figcaption")],-1)),e(" 这是一张图片，ocr 内容为： "),n[372]||(n[372]=t('<figure><img src="https://cdn.nlark.com/yuque/0/2026/jpeg/62301513/1768206511355-abe64513-b838-493f-a2c5-0e3cc3c22659.jpeg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="元数据" tabindex="-1"><a class="header-anchor" href="#元数据"><span>元数据</span></a></h3><p>元数据 (Metadata) 最本质的定义是 <strong>&quot;描述数据的数据&quot;(Data about Data)</strong>，又称中介数据、中继数据。它不包含数据本身的内容（如照片的像素、文档的文字），而是提供关于数据的属性、上下文、结构和管理规则等信息，帮助人们理解、查找、组织和使用数据。</p><h2 id="kafka-kraft-元数据管理全解析" tabindex="-1"><a class="header-anchor" href="#kafka-kraft-元数据管理全解析"><span>Kafka KRaft 元数据管理全解析</span></a></h2>',4)),l("p",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[97]||(n[97]=[s("核心结论",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[98]||(n[98]=[s("：KRaft (Kafka Raft) 通过内置的",-1)])]),_:1}),l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[99]||(n[99]=[s("Raft 共识协议",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[100]||(n[100]=[s("与",-1)])]),_:1}),l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[101]||(n[101]=[s("__cluster_metadata 内部主题",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[102]||(n[102]=[s("实现元数据自主管理，移除对 ZooKeeper 的依赖，形成 ** 控制器集群 (Controller Quorum)+ 工作节点 (Broker)** 的双层架构，确保元数据的一致性、可用性与高效更新。",-1)])]),_:1})]),n[373]||(n[373]=l("hr",null,null,-1)),l("h2",y,[l("a",v,[l("span",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[103]||(n[103]=[s("一、KRaft 元数据管理的核心架构",-1)])]),_:1})])])]),l("h3",x,[l("a",F,[l("span",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[104]||(n[104]=[s("1. 架构转型：从 ZK + 单控制器到 Raft 控制器集群",-1)])]),_:1})])])]),l("table",null,[l("thead",null,[l("tr",null,[l("th",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[105]||(n[105]=[s("维度",-1)])]),_:1})])]),l("th",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[106]||(n[106]=[s("ZK 模式",-1)])]),_:1})])]),l("th",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[107]||(n[107]=[s("KRaft 模式",-1)])]),_:1})])])])]),l("tbody",null,[l("tr",null,[l("td",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[108]||(n[108]=[s("元数据存储",-1)])]),_:1})]),l("td",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[109]||(n[109]=[s("外部 ZooKeeper 的 ZNode 树",-1)])]),_:1})]),l("td",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[110]||(n[110]=[s("内置__cluster_metadata 单分区主题",-1)])]),_:1})])]),l("tr",null,[l("td",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[111]||(n[111]=[s("控制器",-1)])]),_:1})]),l("td",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[112]||(n[112]=[s("单个选举产生的 Controller Broker",-1)])]),_:1})]),l("td",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[113]||(n[113]=[s("3-5 节点的 Controller Quorum (控制器集群)，通过 Raft 选举 Leader",-1)])]),_:1})])]),l("tr",null,[l("td",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[114]||(n[114]=[s("一致性保障",-1)])]),_:1})]),l("td",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[115]||(n[115]=[s("ZK 的 ZAB 协议",-1)])]),_:1})]),l("td",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[116]||(n[116]=[s("KRaft (Raft 协议)，多数派确认机制",-1)])]),_:1})])]),l("tr",null,[l("td",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[117]||(n[117]=[s("故障恢复",-1)])]),_:1})]),l("td",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[118]||(n[118]=[s("分钟级 (依赖 ZK)",-1)])]),_:1})]),l("td",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[119]||(n[119]=[s("秒级 (基于快照与日志)",-1)])]),_:1})])]),l("tr",null,[l("td",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[120]||(n[120]=[s("扩展性",-1)])]),_:1})]),l("td",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[121]||(n[121]=[s("受 ZK 性能限制",-1)])]),_:1})]),l("td",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[122]||(n[122]=[s("随 Kafka 集群线性扩展",-1)])]),_:1})])])])]),l("h3",A,[l("a",S,[l("span",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[123]||(n[123]=[s("2. 核心组件分工",-1)])]),_:1})])])]),l("ul",null,[l("li",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[124]||(n[124]=[s("Active Controller (主控制器)",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[125]||(n[125]=[s("：Raft 集群 Leader，唯一处理元数据变更请求，负责写入__cluster_metadata 日志",-1)])]),_:1})]),l("li",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[126]||(n[126]=[s("Follower Controllers (从控制器)",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[127]||(n[127]=[s("：同步元数据日志，参与 Leader 选举，主控制器故障时自动接管",-1)])]),_:1})]),l("li",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[128]||(n[128]=[s("Brokers (工作节点)",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[129]||(n[129]=[s("：作为元数据日志的 Follower，定期拉取更新，维护本地元数据缓存，处理客户端请求",-1)])]),_:1})])]),n[374]||(n[374]=t("<p>消息通信机制</p><p>1.点对点</p><p>2.发布 - 订阅模式 --Kafka</p><p>1.kafka相关概念</p><p>broker： 集群节点</p><p>producer： 生产者</p><p>consumer： 消费者</p><p>topic： 不同数据，不同topic，消息分布</p><p>partition： 分区</p><p>replication： 副本</p><p>ISR： 副本同步队列</p><p>一般有几个节点，设置几个分区</p><p>分区可以提高吞吐量</p><p>多分区无法保证消息的顺序性</p><p>单分区内消息是顺序的</p>",15)),l("h2",L,[l("a",D,[l("span",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[130]||(n[130]=[s("二、Kafka 消息存储机制：基于分区日志的高效设计",-1)])]),_:1})])])]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[131]||(n[131]=[s("Kafka 的高性能核心源于其",-1)])]),_:1}),n[375]||(n[375]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[132]||(n[132]=[s("日志式存储",-1)])]),_:1}),n[376]||(n[376]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[133]||(n[133]=[s("和",-1)])]),_:1}),n[377]||(n[377]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[134]||(n[134]=[s("分区并行",-1)])]),_:1}),n[378]||(n[378]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[135]||(n[135]=[s("的设计，具体机制如下：",-1)])]),_:1}),l("ol",null,[l("li",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[136]||(n[136]=[s("Partition 日志结构",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[137]||(n[137]=[s("每个 Partition 对应磁盘上的一个目录，目录名格式为 ",-1)])]),_:1}),n[146]||(n[146]=l("code",null,'<font style="color:rgb(0, 0, 0);background-color:rgba(0, 0, 0, 0);">{topic}-{partition id}</font>',-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[138]||(n[138]=[s("。",-1)])]),_:1}),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[139]||(n[139]=[s("目录内的消息被拆分为多个",-1)])]),_:1}),l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[140]||(n[140]=[s("日志分段（Log Segment）",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[141]||(n[141]=[s(" 文件，每个 Segment 由两类文件组成：",-1)])]),_:1}),l("ul",null,[l("li",null,[n[143]||(n[143]=l("code",null,'<font style="color:rgb(0, 0, 0);background-color:rgba(0, 0, 0, 0);">.log</font>',-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[142]||(n[142]=[s(" 文件：存储实际的消息数据",-1)])]),_:1})]),l("li",null,[n[145]||(n[145]=l("code",null,'<font style="color:rgb(0, 0, 0);background-color:rgba(0, 0, 0, 0);">.index</font>',-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[144]||(n[144]=[s(" 文件：消息 offset 与物理存储位置的索引，用于快速查询",-1)])]),_:1})])])]),l("li",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[147]||(n[147]=[s("顺序读写 + 零拷贝技术",-1)])]),_:1})]),l("ul",null,[l("li",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[148]||(n[148]=[s("Kafka 利用磁盘",-1)])]),_:1}),n[151]||(n[151]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[149]||(n[149]=[s("顺序写",-1)])]),_:1}),n[152]||(n[152]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[150]||(n[150]=[s("的特性（顺序写性能远高于随机写），消息追加到 Partition 尾部，避免磁盘寻址开销。",-1)])]),_:1})]),l("li",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[153]||(n[153]=[s("采用 ",-1)])]),_:1}),n[156]||(n[156]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[154]||(n[154]=[s("零拷贝（Zero-Copy）",-1)])]),_:1}),n[157]||(n[157]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[155]||(n[155]=[s(" 技术，直接将数据从内核缓冲区传输到网卡缓冲区，跳过用户态拷贝，大幅提升消息传输效率。",-1)])]),_:1})])])]),l("li",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[158]||(n[158]=[s("offset 与消息持久化",-1)])]),_:1})]),l("ul",null,[l("li",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[159]||(n[159]=[s("每个消息在 Partition 内有唯一的 ",-1)])]),_:1}),n[162]||(n[162]=s("`",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[160]||(n[160]=[s("offset",-1)])]),_:1}),n[163]||(n[163]=s("`",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[161]||(n[161]=[s("，offset 是一个逻辑递增的整数，仅表示消息在 Partition 内的顺序。",-1)])]),_:1})]),l("li",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[164]||(n[164]=[s("消息默认持久化到磁盘，支持配置",-1)])]),_:1}),n[169]||(n[169]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[165]||(n[165]=[s("保留时间",-1)])]),_:1}),n[170]||(n[170]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[166]||(n[166]=[s("或",-1)])]),_:1}),n[171]||(n[171]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[167]||(n[167]=[s("存储大小",-1)])]),_:1}),n[172]||(n[172]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[168]||(n[168]=[s("，过期数据自动清理。",-1)])]),_:1})])])])]),l("h2",c,[l("a",E,[l("span",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[173]||(n[173]=[s("三、Kafka 生产 - 消费核心流程",-1)])]),_:1})])])]),l("h3",q,[l("a",I,[l("span",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[174]||(n[174]=[s("1. 生产者发送消息流程",-1)])]),_:1})])])]),l("ol",null,[l("li",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[175]||(n[175]=[s("生产者向 Kafka 发送消息时，首先通过",-1)])]),_:1}),n[181]||(n[181]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[176]||(n[176]=[s("分区策略",-1)])]),_:1}),n[182]||(n[182]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[177]||(n[177]=[s("确定消息要写入的 Partition：",-1)])]),_:1}),l("ul",null,[l("li",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[178]||(n[178]=[s("轮询策略（默认）：消息均匀分配到所有 Partition",-1)])]),_:1})]),l("li",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[179]||(n[179]=[s("Key 哈希策略：相同 Key 的消息写入同一个 Partition，保证消息有序",-1)])]),_:1})]),l("li",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[180]||(n[180]=[s("自定义策略：用户根据业务规则指定 Partition",-1)])]),_:1})])])]),l("li",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[183]||(n[183]=[s("生产者向目标 Partition 的 ",-1)])]),_:1}),n[194]||(n[194]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[184]||(n[184]=[s("Leader 副本",-1)])]),_:1}),n[195]||(n[195]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[185]||(n[185]=[s("发送消息，同时可通过 ",-1)])]),_:1}),n[196]||(n[196]=s("`",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[186]||(n[186]=[s("acks",-1)])]),_:1}),n[197]||(n[197]=s("`",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[187]||(n[187]=[s(" 参数控制消息可靠性：",-1)])]),_:1}),l("ul",null,[l("li",null,[n[189]||(n[189]=l("code",null,'<font style="color:rgb(0, 0, 0);background-color:rgba(0, 0, 0, 0);">acks=0</font>',-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[188]||(n[188]=[s("：生产者发送后无需等待 Broker 确认，性能最高，可能丢消息",-1)])]),_:1})]),l("li",null,[n[191]||(n[191]=l("code",null,'<font style="color:rgb(0, 0, 0);background-color:rgba(0, 0, 0, 0);">acks=1</font>',-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[190]||(n[190]=[s("：Leader 副本写入成功后即返回确认，Leader 故障可能丢消息",-1)])]),_:1})]),l("li",null,[n[193]||(n[193]=l("code",null,'<font style="color:rgb(0, 0, 0);background-color:rgba(0, 0, 0, 0);">acks=-1/all</font>',-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[192]||(n[192]=[s("：ISR 列表中所有副本写入成功后才返回确认，可靠性最高",-1)])]),_:1})])])]),l("li",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[198]||(n[198]=[s("Leader 副本将消息写入本地日志，Follower 副本主动拉取 Leader 的日志进行同步。",-1)])]),_:1})]),l("li",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[199]||(n[199]=[s("当 ISR 内所有副本同步完成后，Leader 标记消息为",-1)])]),_:1}),n[202]||(n[202]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[200]||(n[200]=[s("已提交",-1)])]),_:1}),n[203]||(n[203]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[201]||(n[201]=[s("，并向生产者返回成功响应。",-1)])]),_:1})])]),l("h3",P,[l("a",C,[l("span",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[204]||(n[204]=[s("2. 消费者消费消息流程",-1)])]),_:1})])])]),l("ol",null,[l("li",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[205]||(n[205]=[s("消费组内的 Consumer 向 Controller 请求获取 Topic 的 Partition 分配方案。",-1)])]),_:1})]),l("li",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[206]||(n[206]=[s("Controller 根据",-1)])]),_:1}),n[209]||(n[209]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[207]||(n[207]=[s("分区分配策略",-1)])]),_:1}),n[210]||(n[210]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[208]||(n[208]=[s("（如 Range、RoundRobin），将不同 Partition 分配给消费组内的不同 Consumer。",-1)])]),_:1})]),l("li",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[211]||(n[211]=[s("Consumer 向分配到的 Partition 的 Leader 副本发起拉取请求，指定要消费的起始 offset。",-1)])]),_:1})]),l("li",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[212]||(n[212]=[s("Leader 副本根据 offset 和索引文件，快速定位消息并返回给 Consumer。",-1)])]),_:1})]),l("li",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[213]||(n[213]=[s("Consumer 消费完成后，主动提交 offset（可配置自动提交或手动提交），记录消费进度，避免重复消费。",-1)])]),_:1})])]),l("h2",K,[l("a",T,[l("span",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[214]||(n[214]=[s("四、Kafka 高可用保障机制",-1)])]),_:1})])])]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[215]||(n[215]=[s("Kafka 集群的高可用核心是 ",-1)])]),_:1}),n[379]||(n[379]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[216]||(n[216]=[s("副本机制 + 控制器故障转移",-1)])]),_:1}),n[380]||(n[380]=s("**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[217]||(n[217]=[s("，确保 Broker 或 Leader 副本故障时，服务不中断：",-1)])]),_:1}),l("ol",null,[l("li",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[218]||(n[218]=[s("Leader 副本选举",-1)])]),_:1})]),l("ul",null,[l("li",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[219]||(n[219]=[s("当 Topic 创建或 Broker 故障时，Controller 负责为每个 Partition 选举 Leader 副本。",-1)])]),_:1})]),l("li",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[220]||(n[220]=[s("选举规则：优先从 ISR 列表中选择副本作为 Leader，保证数据一致性。",-1)])]),_:1})])])]),l("li",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[221]||(n[221]=[s("Broker 故障转移流程",-1)])]),_:1})]),l("ul",null,[l("li",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[222]||(n[222]=[s("若某个 Broker 宕机，该 Broker 上的所有 Leader 副本都会下线。",-1)])]),_:1})]),l("li",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[223]||(n[223]=[s("Controller 检测到 Broker 故障后，立即为这些 Partition 重新选举 Leader（从 ISR 中选）。",-1)])]),_:1})]),l("li",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[224]||(n[224]=[s("新 Leader 上线后，生产者和消费者自动切换到新 Leader，集群恢复正常服务。",-1)])]),_:1})])])]),l("li",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[225]||(n[225]=[s("KRaft 模式 vs ZK 模式的高可用差异",-1)])]),_:1})]),l("ul",null,[l("li",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[226]||(n[226]=[s("ZK 模式",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[227]||(n[227]=[s("：依赖 ZooKeeper 存储元数据、选举 Controller，Controller 为单节点，故障后需重新选举。",-1)])]),_:1})]),l("li",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[228]||(n[228]=[s("KRaft 模式",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[229]||(n[229]=[s("：内置 Raft 协议，采用 Controller Quorum（3-5 节点），Leader 故障时秒级切换，元数据存储在内部主题 ",-1)])]),_:1}),n[231]||(n[231]=l("code",null,'<font style="color:rgb(0, 0, 0);background-color:rgba(0, 0, 0, 0);">__cluster_metadata</font>',-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[230]||(n[230]=[s("，可靠性更高。",-1)])]),_:1})])])])]),l("h2",R,[l("a",N,[l("span",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[232]||(n[232]=[s("五、Kafka 集群核心特性",-1)])]),_:1})])])]),l("ol",null,[l("li",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[233]||(n[233]=[s("高吞吐",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[234]||(n[234]=[s("：分区并行 + 顺序写 + 零拷贝，支持每秒百万级消息处理。",-1)])]),_:1})]),l("li",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[235]||(n[235]=[s("高可用",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[236]||(n[236]=[s("：多副本 + 故障自动转移，集群节点故障不影响服务。",-1)])]),_:1})]),l("li",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[237]||(n[237]=[s("可扩展",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[238]||(n[238]=[s("：支持动态添加 Broker，Partition 可重新分配，集群规模线性扩展。",-1)])]),_:1})]),l("li",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[239]||(n[239]=[s("消息持久化",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[240]||(n[240]=[s("：消息落地磁盘，支持长期存储与回溯消费。",-1)])]),_:1})]),l("li",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[241]||(n[241]=[s("低延迟",-1)])]),_:1})]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[242]||(n[242]=[s("：批量发送 + 零拷贝技术，端到端延迟可低至毫秒级。",-1)])]),_:1})])]),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}}),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}}),l("h2",w,[l("a",B,[l("span",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[243]||(n[243]=[s("卡夫卡流量日志监控平台",-1)])]),_:1})])])]),n[381]||(n[381]=l("h3",{id:"一、项目配置和准备",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#一、项目配置和准备"},[l("span",null,"一、项目配置和准备")])],-1)),n[382]||(n[382]=l("h4",{id:"将linux主机ip修改为静态ip",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#将linux主机ip修改为静态ip"},[l("span",null,"将linux主机ip修改为静态ip")])],-1)),l("p",null,[n[246]||(n[246]=s("在搭建日志监控系统（ELK、Kafka、Filebeat 等）这类服务时，将 Linux 主机 IP 修改为**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[244]||(n[244]=[s("静态 IP",-1)])]),_:1}),n[247]||(n[247]=s("** 是保障服务稳定运行的核心配置，核心原因是 ",-1)),l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[245]||(n[245]=[s("避免 IP 动态变化导致服务链路中断、配置失效和运维成本剧增",-1)])]),_:1})]),n[248]||(n[248]=s("。",-1))]),n[383]||(n[383]=l("h4",{id:"下载依赖软件",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#下载依赖软件"},[l("span",null,"下载依赖软件")])],-1)),n[384]||(n[384]=l("p",null,"dnf install wget vim java-21-openjdk.x86_64 -y",-1)),n[385]||(n[385]=l("h5",{id:"查看ip和网卡型号便于修改ip配置文件-网卡型号可能是ens33或ens160-这里以ens33为例",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#查看ip和网卡型号便于修改ip配置文件-网卡型号可能是ens33或ens160-这里以ens33为例"},[l("span",null,"查看ip和网卡型号便于修改ip配置文件（网卡型号可能是ens33或ens160，这里以ens33为例）")])],-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[249]||(n[249]=[s("ip add",-1)])]),_:1}),e(" 这是一张图片，ocr 内容为： "),n[386]||(n[386]=l("figure",null,[l("img",{src:"https://cdn.nlark.com/yuque/0/2026/png/62301513/1768656659078-6082928a-6ed3-46e1-9769-f37f577f6464.png",alt:"",tabindex:"0",loading:"lazy"}),l("figcaption")],-1)),l("h5",z,[l("a",M,[l("span",null,[n[251]||(n[251]=s("查看本地域名解析地址，将虚拟机ip和nameserver写入",-1)),r(a,{style:{color:"#000000"}},{default:o(()=>[...n[250]||(n[250]=[s("/etc/NetworkManager/system-connections/ens33.nmconnection下的addressesl，DNS设置为默认的114.114.114.114。",-1)])]),_:1})])])]),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[252]||(n[252]=[s("vim /etc/resolv.conf ",-1)])]),_:1}),e(" 这是一张图片，ocr 内容为： "),n[387]||(n[387]=l("figure",null,[l("img",{src:"https://cdn.nlark.com/yuque/0/2026/png/62301513/1768656975558-f3dcab85-4b91-4672-9a67-89b627b45efc.png",alt:"",tabindex:"0",loading:"lazy"}),l("figcaption")],-1)),n[388]||(n[388]=l("h5",{id:"修改linux下的配置文件",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#修改linux下的配置文件"},[l("span",null,"修改linux下的配置文件")])],-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[253]||(n[253]=[s("vim /etc/NetworkManager/system-connections/ens33.nmconnection",-1)])]),_:1}),e(" 这是一张图片，ocr 内容为： "),n[389]||(n[389]=l("figure",null,[l("img",{src:"https://cdn.nlark.com/yuque/0/2026/png/62301513/1768656791115-4eb2474f-7d63-4693-8ff8-156d336ed4d2.png",alt:"",tabindex:"0",loading:"lazy"}),l("figcaption")],-1)),n[390]||(n[390]=l("h5",{id:"修改后重新加载配置",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#修改后重新加载配置"},[l("span",null,"修改后重新加载配置")])],-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[254]||(n[254]=[s("nmcli c reload #重新加载配置",-1)])]),_:1}),n[391]||(n[391]=l("h5",{id:"如果出现断连-进入vm中在虚拟机中输入以下代码重新启动虚拟机网卡",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#如果出现断连-进入vm中在虚拟机中输入以下代码重新启动虚拟机网卡"},[l("span",null,"如果出现断连，进入vm中在虚拟机中输入以下代码重新启动虚拟机网卡")])],-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[255]||(n[255]=[s("#如果断连了",-1)])]),_:1}),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[256]||(n[256]=[s(" nmcli d status",-1)])]),_:1}),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[257]||(n[257]=[s(" nmcli d up ens33",-1)])]),_:1}),n[392]||(n[392]=l("h5",{id:"修改主机名-方便在后续操作中用主机名进行通讯-避免直接写ip",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#修改主机名-方便在后续操作中用主机名进行通讯-避免直接写ip"},[l("span",null,"修改主机名，方便在后续操作中用主机名进行通讯（避免直接写ip）")])],-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[258]||(n[258]=[s("hostnamectl set-hostname kafka1",-1)])]),_:1}),n[393]||(n[393]=l("h5",{id:"修改-etc-hosts文件-添加主机名和ip地址映射",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#修改-etc-hosts文件-添加主机名和ip地址映射"},[l("span",null,"修改/etc/hosts文件，添加主机名和ip地址映射")])],-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[259]||(n[259]=[s("vim /etc/hosts",-1)])]),_:1}),l("p",null,[n[262]||(n[262]=s("修改 Linux 系统的 ",-1)),n[263]||(n[263]=l("code",null,'<font style="color:rgb(0, 0, 0);background-color:rgba(0, 0, 0, 0);">/etc/hosts</font>',-1)),n[264]||(n[264]=s(" 文件，添加 ",-1)),l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[260]||(n[260]=[s("IP 地址与主机名的映射关系",-1)])]),_:1})]),n[265]||(n[265]=s("，核心目的是 ",-1)),l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[261]||(n[261]=[s("绕过 DNS 解析、实现快速的主机名寻址",-1)])]),_:1})]),n[266]||(n[266]=s("，同时保障服务访问的稳定性、安全性和运维效率。",-1))]),e(" 这是一张图片，ocr 内容为： "),n[394]||(n[394]=l("figure",null,[l("img",{src:"https://cdn.nlark.com/yuque/0/2026/png/62301513/1768657703870-9665235c-d1f4-4ed9-9263-5cb9480cffec.png",alt:"",tabindex:"0",loading:"lazy"}),l("figcaption")],-1)),n[395]||(n[395]=l("h3",{id:"如果windows需要连接kafka集群也需要修改hosts的ip地址映射",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#如果windows需要连接kafka集群也需要修改hosts的ip地址映射"},[l("span",null,"如果windows需要连接kafka集群也需要修改hosts的ip地址映射")])],-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[267]||(n[267]=[s("window连接需要在本地修改 C:\\Windows\\System32\\drivers\\etc\\hosts 文件添加映射（需要管理员权限）",-1)])]),_:1}),n[396]||(n[396]=l("h5",{id:"关闭每一台机器的selinux与防火墙",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#关闭每一台机器的selinux与防火墙"},[l("span",null,"关闭每一台机器的selinux与防火墙")])],-1)),n[397]||(n[397]=l("h6",{id:"关闭防火墙",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#关闭防火墙"},[l("span",null,"关闭防火墙：")])],-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[268]||(n[268]=[s(" iptables -F #清空防火墙规则",-1)])]),_:1}),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[269]||(n[269]=[s(" systemctl stop firewalld #关闭防火墙服务",-1)])]),_:1}),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[270]||(n[270]=[s(" systemctl disable firewalld #设置开机不自启",-1)])]),_:1}),n[398]||(n[398]=l("h6",{id:"关闭selinux-编辑-etc-selinux-config-文件",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#关闭selinux-编辑-etc-selinux-config-文件"},[l("span",null,"关闭selinux，编辑/etc/selinux/config 文件")])],-1)),n[399]||(n[399]=l("pre",null,[l("code",null,`<font style="color:#DF2A3F;">SELINUX=disabled</font>
`)],-1)),n[400]||(n[400]=l("p",null,"重启系统：",-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[271]||(n[271]=[s(" reboot",-1)])]),_:1}),n[401]||(n[401]=l("h3",{id:"二、部署kafka集群",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#二、部署kafka集群"},[l("span",null,"二、部署kafka集群")])],-1)),n[402]||(n[402]=l("h4",{id:"下载kafka将kafka压缩包放在opt目录下",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#下载kafka将kafka压缩包放在opt目录下"},[l("span",null,"下载kafka将kafka压缩包放在opt目录下")])],-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[272]||(n[272]=[s("cd /opt",-1)])]),_:1}),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[273]||(n[273]=[s("wget ",-1)])]),_:1}),n[403]||(n[403]=s("[",-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[274]||(n[274]=[s("https://archive.apache.org/dist/kafka/3.6.1/kafka_2.13-3.6.1.tgz",-1)])]),_:1}),n[404]||(n[404]=s("](",-1)),n[405]||(n[405]=l("a",{href:"https://archive.apache.org/dist/kafka/3.6.1/kafka_2.13-3.6.1.tgz",target:"_blank",rel:"noopener noreferrer"},"https://archive.apache.org/dist/kafka/3.6.1/kafka_2.13-3.6.1.tgz",-1)),n[406]||(n[406]=s(")",-1)),n[407]||(n[407]=l("p",null,"解压缩",-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[275]||(n[275]=[s("tar xf kafka_2.13-3.6.1.tgz ",-1)])]),_:1}),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[276]||(n[276]=[s("cd kafka_2.13-3.6.1",-1)])]),_:1}),n[408]||(n[408]=l("h4",{id:"修改kafka的配置文件位于kafka目录下config-kraft-server-properties",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#修改kafka的配置文件位于kafka目录下config-kraft-server-properties"},[l("span",null,"修改kafka的配置文件位于kafka目录下config/kraft/server.properties")])],-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[277]||(n[277]=[s("vim /opt/kafka_2.13-3.6.1/config/kraft",-1)])]),_:1}),e(" 这是一张图片，ocr 内容为： "),n[409]||(n[409]=t(`<figure><img src="https://cdn.nlark.com/yuque/0/2026/png/62301513/1768658316170-bf215910-cb05-4e70-a3cb-0f3d3c54dda3.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="修改配置文件-位于kafka目录下config-kraft-server-properties" tabindex="-1"><a class="header-anchor" href="#修改配置文件-位于kafka目录下config-kraft-server-properties"><span>修改配置文件,位于kafka目录下config/kraft/server.properties</span></a></h4><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-plain"><span class="line"><span>#修改节点id，每个节点唯一</span></span>
<span class="line"><span>node.id=1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#修改控制器投票列表</span></span>
<span class="line"><span>controller.quorum.voters=1@192.168.223.161:9093,2@192.168.223.162:9093,3@192.168.223.163:9093</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#修改监听器和控制器，绑定ip。其中kafka1为主机名，可用本机ip地址代替</span></span>
<span class="line"><span>listeners=PLAINTEXT://kafka1:9092,CONTROLLER://kafka1:9093</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 侦听器名称、主机名和代理将向客户端公布的端口.(broker 对外暴露的地址)</span></span>
<span class="line"><span># 如果未设置，则使用&quot;listeners&quot;的值.</span></span>
<span class="line"><span>advertised.listeners=PLAINTEXT://kafka1:9092</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><em>配置文件详解</em></li></ul><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-plain"><span class="line"><span>############################# Server Basics #############################</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 此服务器的角色。设置此项将进入KRaft模式(controller 相当于主机、broker 节点相当于从机,主机类似 zk 功能)</span></span>
<span class="line"><span>process.roles=broker,controller</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 节点 ID</span></span>
<span class="line"><span>node.id=2</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 全 Controller 列表</span></span>
<span class="line"><span>controller.quorum.voters=2@192.168.58.130:9093,3@192.168.58.131:9093,4@192.168.58.132:9093</span></span>
<span class="line"><span></span></span>
<span class="line"><span>############################# Socket Server Settings #############################</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 套接字服务器侦听的地址.</span></span>
<span class="line"><span># 组合节点（即具有\`process.roles=broker,controller\`的节点）必须至少在此处列出控制器侦听器</span></span>
<span class="line"><span># 如果没有定义代理侦听器，那么默认侦听器将使用一个等于java.net.InetAddress.getCanonicalHostName()值的主机名,</span></span>
<span class="line"><span># 带有PLAINTEXT侦听器名称和端口9092</span></span>
<span class="line"><span>#   FORMAT:</span></span>
<span class="line"><span>#     listeners = listener_name://host_name:port</span></span>
<span class="line"><span>#   EXAMPLE:</span></span>
<span class="line"><span>#     listeners = PLAINTEXT://your.host.name:9092</span></span>
<span class="line"><span>#不同服务器绑定的端口</span></span>
<span class="line"><span>listeners=PLAINTEXT://192.168.58.130:9092,CONTROLLER://192.168.58.130:9093</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 用于代理之间通信的侦听器的名称(broker 服务协议别名)</span></span>
<span class="line"><span>inter.broker.listener.name=PLAINTEXT</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 侦听器名称、主机名和代理将向客户端公布的端口.(broker 对外暴露的地址)</span></span>
<span class="line"><span># 如果未设置，则使用&quot;listeners&quot;的值.</span></span>
<span class="line"><span>advertised.listeners=PLAINTEXT://192.168.58.130:9092</span></span>
<span class="line"><span></span></span>
<span class="line"><span># controller 服务协议别名</span></span>
<span class="line"><span># 控制器使用的侦听器名称的逗号分隔列表</span></span>
<span class="line"><span># 如果\`listener.security.protocol.map\`中未设置显式映射，则默认使用PLAINTEXT协议</span></span>
<span class="line"><span># 如果在KRaft模式下运行，这是必需的。</span></span>
<span class="line"><span>controller.listener.names=CONTROLLER</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 将侦听器名称映射到安全协议，默认情况下它们是相同的。(协议别名到安全协议的映射)有关更多详细信息，请参阅配置文档.</span></span>
<span class="line"><span>listener.security.protocol.map=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 服务器用于从网络接收请求并向网络发送响应的线程数</span></span>
<span class="line"><span>num.network.threads=3</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 服务器用于处理请求的线程数，其中可能包括磁盘I/O</span></span>
<span class="line"><span>num.io.threads=8</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 套接字服务器使用的发送缓冲区（SO_SNDBUF）</span></span>
<span class="line"><span>socket.send.buffer.bytes=102400</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 套接字服务器使用的接收缓冲区（SO_RCVBUF）</span></span>
<span class="line"><span>socket.receive.buffer.bytes=102400</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 套接字服务器将接受的请求的最大大小（防止OOM）</span></span>
<span class="line"><span>socket.request.max.bytes=104857600</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>############################# Log Basics #############################</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 存储日志文件的目录的逗号分隔列表(kafka 数据存储目录)</span></span>
<span class="line"><span>log.dirs=/usr/kafka/kafka_2.13-3.6.1/datas</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 每个主题的默认日志分区数。更多的分区允许更大的并行性以供使用，但这也会导致代理之间有更多的文件。</span></span>
<span class="line"><span>num.partitions=1</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 启动时用于日志恢复和关闭时用于刷新的每个数据目录的线程数。</span></span>
<span class="line"><span># 对于数据目录位于RAID阵列中的安装，建议增加此值。</span></span>
<span class="line"><span>num.recovery.threads.per.data.dir=1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>############################# Internal Topic Settings  #############################</span></span>
<span class="line"><span># 组元数据内部主题&quot;__consumer_offsets&quot;和&quot;__transaction_state&quot;的复制因子</span></span>
<span class="line"><span># 对于除开发测试以外的任何测试，建议使用大于1的值来确保可用性，例如3.</span></span>
<span class="line"><span>offsets.topic.replication.factor=1</span></span>
<span class="line"><span>transaction.state.log.replication.factor=1</span></span>
<span class="line"><span>transaction.state.log.min.isr=1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>############################# Log Flush Policy #############################</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 消息会立即写入文件系统，但默认情况下，我们只使用fsync()进行同步</span></span>
<span class="line"><span># 操作系统缓存延迟。以下配置控制将数据刷新到磁盘.</span></span>
<span class="line"><span># 这里有一些重要的权衡:</span></span>
<span class="line"><span>#    1. Durability(持久性): 如果不使用复制，未清理的数据可能会丢失</span></span>
<span class="line"><span>#    2. Latency(延迟): 当刷新发生时，非常大的刷新间隔可能会导致延迟峰值，因为将有大量数据要刷新.</span></span>
<span class="line"><span>#    3. Throughput(吞吐量): 刷新通常是最昂贵的操作，较小的刷新间隔可能导致过多的寻道.</span></span>
<span class="line"><span># 下面的设置允许配置刷新策略，以便在一段时间后或每N条消息（或两者兼有）刷新数据。这可以全局完成，并在每个主题的基础上覆盖</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 强制将数据刷新到磁盘之前要接受的消息数</span></span>
<span class="line"><span>#log.flush.interval.messages=10000</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 在我们强制刷新之前，消息可以在日志中停留的最长时间</span></span>
<span class="line"><span>#log.flush.interval.ms=1000</span></span>
<span class="line"><span></span></span>
<span class="line"><span>############################# Log Retention Policy #############################</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 以下配置控制日志段的处理。可以将该策略设置为在一段时间后删除分段，或者在累积了给定大小之后删除分段。</span></span>
<span class="line"><span># 只要满足这些条件中的任意一个，segment就会被删除。删除总是从日志的末尾开始</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 日志文件因使用年限而有资格删除的最短使用年限</span></span>
<span class="line"><span>log.retention.hours=168</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 基于大小的日志保留策略。除非剩余的段低于log.retention.bytes，否则将从日志中删除段。独立于log.retention.hours的函数。</span></span>
<span class="line"><span>#log.retention.bytes=1073741824</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 日志segment文件的最大大小。当达到此大小时，将创建一个新的日志segment</span></span>
<span class="line"><span>log.segment.bytes=1073741824</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 检查日志segments以查看是否可以根据保留策略删除它们的间隔</span></span>
<span class="line"><span>log.retention.check.interval.ms=300000</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="创建kafka集群" tabindex="-1"><a class="header-anchor" href="#创建kafka集群"><span>创建kafka集群</span></a></h4>`,6)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[278]||(n[278]=[s("cd /opt/kafka_2.13-3.6.1",-1)])]),_:1}),n[410]||(n[410]=l("h1",{id:"在其中一台执行-生成集群uuid命令-拿到集群uuid保存在当前tmp-random文件中",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#在其中一台执行-生成集群uuid命令-拿到集群uuid保存在当前tmp-random文件中"},[l("span",null,"在其中一台执行，生成集群UUID命令，拿到集群UUID保存在当前tmp_random文件中")])],-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[279]||(n[279]=[s("bin/kafka-storage.sh random-uuid >tmp_random",-1)])]),_:1}),n[411]||(n[411]=l("h1",{id:"查看uuid",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#查看uuid"},[l("span",null,"查看uuid")])],-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[280]||(n[280]=[s("[root@chainmaker1 kafka_2.13-3.6.1]# cat tmp_random",-1)])]),_:1}),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[281]||(n[281]=[s(" z3oq9M4IQguOBm2rt1ovmQ",-1)])]),_:1}),n[412]||(n[412]=l("h1",{id:"在所有机器上执行-它会初始化存储区域-为-kafka-集群的元数据存储和后续操作做好准备。z3oq9m4iqguobm2rt1ovmq为自己生成的集群uuid",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#在所有机器上执行-它会初始化存储区域-为-kafka-集群的元数据存储和后续操作做好准备。z3oq9m4iqguobm2rt1ovmq为自己生成的集群uuid"},[l("span",null,"在所有机器上执行，它会初始化存储区域，为 Kafka 集群的元数据存储和后续操作做好准备。z3oq9M4IQguOBm2rt1ovmQ为自己生成的集群uuid")])],-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[282]||(n[282]=[s("bin/kafka-storage.sh format -t z3oq9M4IQguOBm2rt1ovmQ -c /opt/kafka_2.13-3.6.1/config/kraft/server.properties",-1)])]),_:1}),n[413]||(n[413]=l("h4",{id:"启动kafka",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#启动kafka"},[l("span",null,"启动kafka")])],-1)),n[414]||(n[414]=l("h6",{id:"命令行启动",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#命令行启动"},[l("span",null,"命令行启动")])],-1)),n[415]||(n[415]=l("p",null,"启动：",-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[283]||(n[283]=[s(" bin/kafka-server-start.sh -daemon /opt/kafka_2.13-3.6.1/config/kraft/server.properties",-1)])]),_:1}),n[416]||(n[416]=l("p",null,"关闭：",-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[284]||(n[284]=[s("bin/kafka-server-stop.sh",-1)])]),_:1}),n[417]||(n[417]=l("h6",{id:"使用systemctl管理服务-systemd",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#使用systemctl管理服务-systemd"},[l("span",null,"使用systemctl管理服务 -- systemd")])],-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[285]||(n[285]=[s("编辑文件 /usr/lib/systemd/system/kafka.service ",-1)])]),_:1}),n[418]||(n[418]=t(`<div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-plain"><span class="line"><span>[Unit]</span></span>
<span class="line"><span>Description=Apache Kafka server (KRaft mode)</span></span>
<span class="line"><span>Documentation=http://kafka.apache.org/documentation.html</span></span>
<span class="line"><span>After=network.target</span></span>
<span class="line"><span>[Service]</span></span>
<span class="line"><span>Type=forking</span></span>
<span class="line"><span>User=root</span></span>
<span class="line"><span>Group=root</span></span>
<span class="line"><span>Environment=&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin:/usr/lib/jvm/java-11-openjdk-11.0.23.0.9-2.el7_9.x86_64/bin/&quot;</span></span>
<span class="line"><span>ExecStart=/opt/kafka_2.13-3.6.1/bin/kafka-server-start.sh -daemon /opt/kafka_2.13-3.6.1/config/kraft/server.properties</span></span>
<span class="line"><span>ExecStop=/opt/kafka_2.13-3.6.1/bin/kafka-server-stop.sh</span></span>
<span class="line"><span>Restart=on-failure</span></span>
<span class="line"><span>[Install]</span></span>
<span class="line"><span>WantedBy=multi-user.target</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重新加载systemd配置</p>`,2)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[286]||(n[286]=[s("systemctl daemon-reload",-1)])]),_:1}),n[419]||(n[419]=l("p",null,"启动kafka服务",-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[287]||(n[287]=[s("systemctl start kafka",-1)])]),_:1}),n[420]||(n[420]=l("p",null,"关闭kafka服务",-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[288]||(n[288]=[s("systemctl stop kafka",-1)])]),_:1}),n[421]||(n[421]=l("p",null,"设置开机自启",-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[289]||(n[289]=[s("systemctl enable kafka",-1)])]),_:1}),r(a,{style:{color:"#DF2A3F"}}),n[422]||(n[422]=l("p",null,"查看kafka状态",-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[290]||(n[290]=[s("systemctl status kafka",-1)])]),_:1}),e(" 这是一张图片，ocr 内容为： "),n[423]||(n[423]=t('<figure><img src="https://cdn.nlark.com/yuque/0/2026/png/62301513/1768658739079-513543e2-e284-4e60-a9b9-d64be0c2273d.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="测试集群" tabindex="-1"><a class="header-anchor" href="#测试集群"><span>测试集群</span></a></h4><h1 id="创建topic" tabindex="-1"><a class="header-anchor" href="#创建topic"><span>创建topic</span></a></h1>',3)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[291]||(n[291]=[s("bin/kafka-topics.sh --create --bootstrap-server kafka3:9092 --replication-factor 3 --partitions 3 --topic my_topic",-1)])]),_:1}),n[424]||(n[424]=l("p",null,"** --replication-factor指定副本因子，--partitions指定分区数，--topic指定主题名称。",-1)),n[425]||(n[425]=l("h1",{id:"查看topic",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#查看topic"},[l("span",null,"查看topic")])],-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[292]||(n[292]=[s("bin/kafka-topics.sh --list --bootstrap-server kafka3:9092",-1)])]),_:1}),n[426]||(n[426]=l("p",null,"#创建生产者，发送消息，测试用（在不同虚拟机上测试）",-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[293]||(n[293]=[s("bin/kafka-console-producer.sh --broker-list kafka3:9092 --topic my_topic",-1)])]),_:1}),n[427]||(n[427]=l("p",null,"#创建消费者，获取数据，测试用（在不同虚拟机上测试）",-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[294]||(n[294]=[s("bin/kafka-console-consumer.sh --bootstrap-server kafka1:9092 --topic my_topic --from-beginning",-1)])]),_:1}),n[428]||(n[428]=l("h3",{id:"三、部署filebeat",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#三、部署filebeat"},[l("span",null,"三、部署filebeat")])],-1)),l("p",null,[l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[295]||(n[295]=[s("Filebeat",-1)])]),_:1})]),n[299]||(n[299]=s(" 是 Elastic 公司推出的一款**",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[296]||(n[296]=[s("轻量级、开源的日志采集器",-1)])]),_:1}),n[300]||(n[300]=l("strong",null,"，专为在服务器上高效收集、转发日志数据而设计，是 ELK（Elasticsearch、Logstash、Kibana）技术栈中负责",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[297]||(n[297]=[s("日志采集环节",-1)])]),_:1}),n[301]||(n[301]=l("strong",null,"的核心组件，也是你搭建的日志监控系统里的",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[298]||(n[298]=[s("数据入口",-1)])]),_:1}),n[302]||(n[302]=s("**。",-1))]),n[429]||(n[429]=l("h3",{id:"celery部署",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#celery部署"},[l("span",null,"Celery部署")])],-1)),n[430]||(n[430]=l("h4",{id:"celery下载",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#celery下载"},[l("span",null,"celery下载")])],-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[303]||(n[303]=[s("cd /opt",-1)])]),_:1}),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[304]||(n[304]=[s("mkdir monitor/celery_app -p",-1)])]),_:1}),n[431]||(n[431]=t(`<h4 id="编辑配置文件config-py" tabindex="-1"><a class="header-anchor" href="#编辑配置文件config-py"><span>编辑配置文件 <a href="http://config.py" target="_blank" rel="noopener noreferrer">config.py</a></span></a></h4><p>from celery.schedules import crontab<br> BROKER_URL = &#39;redis://192.168.20.161:6379/0&#39; # Broker配置，使用Redis作为消息中间件<br> CELERY_RESULT_BACKEND = &#39;redis://192.168.20.161:6379/1&#39; # BACKEND配置，这里使用redis<br> CELERY_RESULT_SERIALIZER = &#39;json&#39; # 结果序列化方案<br> CELERY_TASK_RESULT_EXPIRES = 60 * 60 * 24 # 任务过期时间<br> CELERY_TIMEZONE=&#39;Asia/Shanghai&#39; # 时区配置<br> CELERY_IMPORTS = ( # 指定导入的任务模块,可以指定多个<br> &#39;celery_app.task&#39;,<br> )</p><p>CELERYBEAT_SCHEDULE = {<br> &#39;celery_app.task.test&#39;: {<br> &#39;task&#39;: &#39;celery_app.task.test&#39;,<br> &#39;schedule&#39;: crontab(minute=&#39;*/1&#39;),<br> &#39;args&#39;: (-3, 10)<br> }<br> }</p><h4 id="_2、编辑-init-py-双下划线开头-双下划线结尾" tabindex="-1"><a class="header-anchor" href="#_2、编辑-init-py-双下划线开头-双下划线结尾"><span>2、编辑__init__.py (双下划线开头，双下划线结尾)</span></a></h4><p>from celery import Celery<br> app = Celery(&#39;task&#39;)<br> app.config_from_object(&#39;celery_app.config&#39;)</p><h4 id="_3、编辑task-py" tabindex="-1"><a class="header-anchor" href="#_3、编辑task-py"><span>3、<a href="http://xn--task-pj6ks03f.py" target="_blank" rel="noopener noreferrer">编辑task.py</a></span></a></h4><p>from . import app<br> @app.task<br> def test(a,b):<br> print(&quot;task test start ...&quot;)<br> result = abs(a) + abs(b)<br> print(&quot;task test end....&quot;)<br> return result</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-plain"><span class="line"><span></span></span>
<span class="line"><span>* celery 启动beat (在monitor目录下执行)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>celery -A celery_app beat</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-plain"><span class="line"><span></span></span>
<span class="line"><span>* celery 启动worker</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>celery -A celery_app worker -l info -c 4</p><p>启动</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-plain"><span class="line"><span># 进入项目根目录</span></span>
<span class="line"><span>cd /opt/monitor</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 安装依赖（首次执行）</span></span>
<span class="line"><span>pip3 install pymysql sqlalchemy celery redis -i https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 杀死旧的Celery进程（避免冲突）</span></span>
<span class="line"><span>ps -ef | grep celery | grep -v grep | awk &#39;{print $2}&#39; | xargs kill -9 2&gt;/dev/null</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 启动Celery Beat（调度器）</span></span>
<span class="line"><span>nohup celery -A celery_app beat &gt; celery_beat.log 2&gt;&amp;1 &amp;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 启动Celery Worker（执行器）</span></span>
<span class="line"><span>nohup celery -A celery_app worker --loglevel=info &gt; celery_worker.log 2&gt;&amp;1 &amp;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 查看进程是否正常运行</span></span>
<span class="line"><span>ps -ef | grep celery</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="redis部署" tabindex="-1"><a class="header-anchor" href="#redis部署"><span>redis部署</span></a></h3><h4 id="redis安装" tabindex="-1"><a class="header-anchor" href="#redis安装"><span>redis安装</span></a></h4>`,15)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[305]||(n[305]=[s(" yum install -y epel-release",-1)])]),_:1}),r(a,{style:{color:"#DF2A3F"}}),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[306]||(n[306]=[s(" dnf install -y epel-release",-1)])]),_:1}),r(a,{style:{color:"#DF2A3F"}}),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[307]||(n[307]=[s(" dnf install -y https://rpms.remirepo.net/enterprise/remi-release-10.rpm",-1)])]),_:1}),r(a,{style:{color:"#DF2A3F"}}),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[308]||(n[308]=[s(" dnf module enable -y redis:remi-7.2 ",-1)])]),_:1}),r(a,{style:{color:"#DF2A3F"}}),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[309]||(n[309]=[s(" dnf install -y redis ",-1)])]),_:1}),r(a,{style:{color:"#DF2A3F"}}),n[432]||(n[432]=l("h4",{id:"redis-cli连接数据库",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#redis-cli连接数据库"},[l("span",null,"redis-cli连接数据库")])],-1)),n[433]||(n[433]=l("h5",{id:"关闭数据库保护模式",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#关闭数据库保护模式"},[l("span",null,"关闭数据库保护模式")])],-1)),n[434]||(n[434]=l("p",null,"临时关闭",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[310]||(n[310]=[s("执行命令关闭保护模式 ",-1)])]),_:1}),n[435]||(n[435]=s()),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[311]||(n[311]=[s("CONFIG SET protected-mode no ",-1)])]),_:1}),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[312]||(n[312]=[s("验证是否关闭成功（返回no则正确） ",-1)])]),_:1}),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[313]||(n[313]=[s(" CONFIG GET protected-mode ",-1)])]),_:1}),n[436]||(n[436]=l("h5",{id:"永久关闭",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#永久关闭"},[l("span",null,"永久关闭")])],-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[314]||(n[314]=[s("编辑Redis配置文件（老版本在/etc/redis.conf ）",-1)])]),_:1}),r(a,{style:{color:"#DF2A3F","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[315]||(n[315]=[s("vim",-1)])]),_:1}),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[316]||(n[316]=[s(" /etc/redis/redis.conf ",-1)])]),_:1}),n[437]||(n[437]=l("p",null,"找到以下配置行，修改为no",-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[317]||(n[317]=[s("protected-mode no",-1)])]),_:1}),e(" 这是一张图片，ocr 内容为： "),n[438]||(n[438]=l("figure",null,[l("img",{src:"https://cdn.nlark.com/yuque/0/2026/png/62301513/1768805475222-1f1c586e-da7a-493f-939f-bdbb505159dd.png",alt:"",tabindex:"0",loading:"lazy"}),l("figcaption")],-1)),n[439]||(n[439]=l("p",null,"保存后重启Redis服务",-1)),r(a,{style:{color:"#DF2A3F"}},{default:o(()=>[...n[318]||(n[318]=[s("systemctl restart redis",-1)])]),_:1}),n[440]||(n[440]=s()),n[441]||(n[441]=l("p",null,"同时修改",-1)),n[442]||(n[442]=l("p",null,"bind 0.0.0.0 #监听本机任意ip",-1)),e(" 这是一张图片，ocr 内容为： "),n[443]||(n[443]=t(`<figure><img src="https://cdn.nlark.com/yuque/0/2026/png/62301513/1768805497859-994bc565-a8aa-4fbf-83b4-7f502ae150df.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="nginx部署" tabindex="-1"><a class="header-anchor" href="#nginx部署"><span>nginx部署</span></a></h3><ul><li><p>安装nginx</p><p>dnf install nginx -y</p></li></ul><p>编辑配置文件 /etc/nginx/conf.d/sc.conf</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-plain"><span class="line"><span>upstream flask {</span></span>
<span class="line"><span>     server 192.168.20.162:5000;</span></span>
<span class="line"><span>     server 192.168.20.163:5000;</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  server {</span></span>
<span class="line"><span>      server_name www.sc.com;</span></span>
<span class="line"><span>      location / {</span></span>
<span class="line"><span>         proxy_pass http://flask;</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动nginx</p><p>systemctl start nginx</p><h2 id="elk近实时日志分析" tabindex="-1"><a class="header-anchor" href="#elk近实时日志分析"><span>ELK近实时日志分析</span></a></h2><p>elaticsearch</p>`,9)),l("p",null,[n[321]||(n[321]=s("Elasticsearch（简称 ES）是一款 ",-1)),l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[319]||(n[319]=[s("分布式、RESTful 风格的开源搜索引擎",-1)])]),_:1})]),n[322]||(n[322]=s("，基于 Lucene 底层构建，核心定位是 ",-1)),l("strong",null,[r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[320]||(n[320]=[s("“快速检索、分析海量数据”",-1)])]),_:1})]),n[323]||(n[323]=s("，支持结构化 / 非结构化数据（日志、文本、JSON 等）的实时查询、聚合分析，广泛用于日志检索、全文搜索、监控告警、数据分析等场景。",-1))]),n[444]||(n[444]=t('<h3 id="elasticsearch-es-速度远快于mysql的原因" tabindex="-1"><a class="header-anchor" href="#elasticsearch-es-速度远快于mysql的原因"><span>Elasticsearch（ES）速度远快于Mysql的原因</span></a></h3><p>Elasticsearch（ES）速度远超MySQL的核心原因，本质是<strong>两者的设计目标和底层架构完全不同</strong>：MySQL是为「事务性数据存储+精准查询」设计的关系型数据库，而ES是为「海量非结构化/半结构化数据的全文检索+聚合分析」设计的分布式搜索引擎，从底层原理到查询逻辑都做了极致的性能优化。</p><h4 id="一、核心设计目标差异-根源" tabindex="-1"><a class="header-anchor" href="#一、核心设计目标差异-根源"><span>一、核心设计目标差异（根源）</span></a></h4><table><thead><tr><th>Elasticsearch</th><th>MySQL</th></tr></thead><tbody><tr><td>目标是「快速检索/聚合海量数据」，牺牲部分写入性能、事务性，换取查询速度</td><td>目标是「安全存储/精准读写事务性数据」，优先保证ACID、数据一致性，查询性能是次要优化方向</td></tr><tr><td>典型场景：日志检索、全文搜索、实时监控、大数据分析（千万/亿级数据）</td><td>典型场景：业务系统数据存储、订单/用户管理、精准条件查询（百万级数据）</td></tr></tbody></table><h4 id="二、es速度快的核心技术原因-逐条拆解" tabindex="-1"><a class="header-anchor" href="#二、es速度快的核心技术原因-逐条拆解"><span>二、ES速度快的核心技术原因（逐条拆解）</span></a></h4><h5 id="_1-倒排索引-最核心-——-检索的-专属优化" tabindex="-1"><a class="header-anchor" href="#_1-倒排索引-最核心-——-检索的-专属优化"><span>1. 倒排索引（最核心！）—— 检索的“专属优化”</span></a></h5><p>这是ES远超MySQL的<strong>根本原因</strong>，MySQL的B+树索引在全文检索/模糊查询场景下完全无法匹敌：</p><ul><li><strong>MySQL的B+树索引</strong>：<br> 为「行记录的精准查找」设计（如<code>where id=123</code>/<code>where user_id&gt;1000</code>），本质是“按字段值找行”。<br> 若做模糊查询（如<code>where content like &#39;%关键词%&#39;</code>），会直接失效，触发全表扫描，速度极慢。</li><li><strong>ES的倒排索引</strong>：<br> 为「全文检索」设计，提前将文本内容拆分为“词条（Term）”，建立“词条→文档ID”的映射表（类似字典的索引）。<br> 比如文本“Nginx监控日志”拆分为<code>nginx</code>/<code>监控</code>/<code>日志</code>，查询“监控”时，直接通过词条找到所有包含该词的文档，无需扫描全量数据。</li></ul><h5 id="_2-分布式架构——-并行处理海量数据" tabindex="-1"><a class="header-anchor" href="#_2-分布式架构——-并行处理海量数据"><span>2. 分布式架构—— 并行处理海量数据</span></a></h5><ul><li><strong>MySQL</strong>：<br> 单机为主，虽支持主从/分库分表，但分表逻辑需业务层实现，查询时无法自动并行计算，单机性能瓶颈明显（百万级以上数据查询变慢）。</li><li><strong>ES</strong>：<br> 天生分布式，数据会自动分片（Shard）存储在多个节点，查询时<strong>多节点并行检索+结果聚合</strong>，相当于“多个人同时找东西，最后汇总结果”，海量数据下性能线性提升。</li></ul><h5 id="_3-内存优先的存储模型——-减少磁盘io" tabindex="-1"><a class="header-anchor" href="#_3-内存优先的存储模型——-减少磁盘io"><span>3. 内存优先的存储模型—— 减少磁盘IO</span></a></h5><ul><li><strong>MySQL</strong>：<br> 数据默认存储在磁盘，虽有Buffer Pool缓存热点数据，但缓存策略为“按需缓存”，且受限于事务/锁机制，无法全部依赖内存。</li><li><strong>ES</strong>：<br> 核心数据（倒排索引、文档数据）优先加载到内存，查询时几乎全内存操作（磁盘仅作持久化），而内存IO速度是磁盘的千倍以上。<br> 同时ES的Lucene底层做了内存对齐、数据压缩等优化，进一步提升内存利用率。</li></ul><h5 id="_4-无事务-锁的轻量化设计——-减少查询开销" tabindex="-1"><a class="header-anchor" href="#_4-无事务-锁的轻量化设计——-减少查询开销"><span>4. 无事务/锁的轻量化设计—— 减少查询开销</span></a></h5><ul><li><strong>MySQL</strong>：<br> 为保证ACID，查询时需处理行锁/表锁、事务隔离级别、MVCC等，这些机制会带来大量性能开销（即使是读操作）。</li><li><strong>ES</strong>：<br> 不支持复杂事务（仅支持简单的文档级原子性），无锁设计，查询时无需处理锁竞争、事务回滚等逻辑，请求处理链路极短。</li></ul><h5 id="_5-列式存储-预聚合——-聚合查询更快" tabindex="-1"><a class="header-anchor" href="#_5-列式存储-预聚合——-聚合查询更快"><span>5. 列式存储+预聚合—— 聚合查询更快</span></a></h5><ul><li><strong>MySQL</strong>：<br> 采用行式存储（一行数据的所有字段存在一起），做聚合查询（如<code>sum(traffic)</code>/<code>group by ip</code>）时，需扫描所有行的指定字段，效率低。</li><li><strong>ES</strong>：<br> 支持列式存储（同一字段的所有值存在一起），且可提前构建聚合桶（Bucket），聚合查询时直接读取预计算结果，无需全量扫描。</li></ul><h5 id="_6-分词-过滤的提前处理——-减少查询时计算" tabindex="-1"><a class="header-anchor" href="#_6-分词-过滤的提前处理——-减少查询时计算"><span>6. 分词/过滤的提前处理—— 减少查询时计算</span></a></h5><ul><li>ES在写入数据时，会提前完成：分词、大小写转换、停用词过滤（如“的/地/得”）、字段类型转换等；</li><li>MySQL在查询时才会处理这些逻辑（如<code>lower(content)</code>/<code>substr(content)</code>），查询时额外增加计算开销。</li></ul><h4 id="三、关键对比-同场景下的性能差异" tabindex="-1"><a class="header-anchor" href="#三、关键对比-同场景下的性能差异"><span>三、关键对比：同场景下的性能差异</span></a></h4><p>假设查询“过去1小时内包含‘error’的Nginx日志，按IP分组统计请求数”（数据量1000万条）：</p><ul><li><strong>MySQL</strong>：<br> 需要执行<code>select ip, count(*) from nginx_log where content like &#39;%error%&#39; and time &gt; xxx group by ip</code>，触发全表扫描+文件排序，耗时可能<strong>几十秒甚至分钟级</strong>；</li><li><strong>ES</strong>：<br> 通过倒排索引快速找到含“error”的文档，分布式并行聚合IP维度的请求数，耗时<strong>毫秒到秒级</strong>。</li></ul><h4 id="四、注意-es不是-万能快" tabindex="-1"><a class="header-anchor" href="#四、注意-es不是-万能快"><span>四、注意：ES不是“万能快”</span></a></h4><p>ES的快是“场景化的快”，在以下场景不如MySQL：</p><ol><li>精准的行级更新/删除（ES更新文档需重建索引，MySQL直接更新行）；</li><li>强事务性操作（如金融交易，MySQL的ACID更可靠）；</li><li>小数据量的简单查询（百万级以内，MySQL的B+树索引足够快，ES的分布式开销反而可能更高）。</li><li>存储大文件</li></ol><h3 id="总结-1" tabindex="-1"><a class="header-anchor" href="#总结-1"><span>总结</span></a></h3><p>ES速度远超MySQL的核心原因可归纳为3点：</p><ol><li><strong>索引层面</strong>：倒排索引专为检索设计，秒杀MySQL的B+树索引（尤其全文/模糊查询）；</li><li><strong>架构层面</strong>：分布式并行处理，突破单机性能瓶颈；</li><li><strong>存储/计算层面</strong>：内存优先+无事务开销+预处理，减少查询时的IO和计算成本。</li></ol><p>简单说：<strong>MySQL是“精准保管数据的仓库管理员”，ES是“快速找东西的搜索专家”</strong>，两者定位不同，导致检索性能天差地别。在你的监控场景中，若需检索海量日志、做实时聚合分析，用ES替代MySQL会带来数量级的性能提升。</p><p>elasticsearch选举</p>',29)),e(" 这是一张图片，ocr 内容为： "),n[445]||(n[445]=l("figure",null,[l("img",{src:"https://cdn.nlark.com/yuque/0/2026/png/62301513/1768813768064-6ea6f197-4e35-442f-9538-8531def6e6f5.png",alt:"",tabindex:"0",loading:"lazy"}),l("figcaption")],-1)),n[446]||(n[446]=l("p",null,"kibana",-1)),n[447]||(n[447]=l("h2",{id:"项目总结",tabindex:"-1"},[l("a",{class:"header-anchor",href:"#项目总结"},[l("span",null,"项目总结")])],-1)),e(" 这是一张图片，ocr 内容为： "),n[448]||(n[448]=l("figure",null,[l("img",{src:"https://cdn.nlark.com/yuque/0/2026/png/62301513/1768895695889-80cac052-2273-4726-a5bd-68e8d0d1ec31.png",alt:"",tabindex:"0",loading:"lazy"}),l("figcaption")],-1)),l("p",null,[n[325]||(n[325]=s("为了监测网站访问状况，对网站日志进行分析，流量监控，我基于kafka搭建了一个日志收集平台，收集nginx反向代理集群的access日志，再进行可视化分析和流量预警，具体操作步骤，我搭建了一个3节点，3分区，3副本的kafka集群和nginx反向代理集群，通过filebeat对nginx上的access.log日志收集，用Kafka作为中间件接收这些日志数据，再通过python脚本消费kafka的储存的数据并进行数据清理选取一些的字段存储在mysql数据库中，用celery的定时任务从mysql中读取数据，实现流量预警功能（超出范围发送邮件告警）和ELK实现对日志数据的可视化分析，其中Elasticsearch用来",-1)),r(a,{style:{color:"rgb(0, 0, 0)","background-color":"rgba(0, 0, 0, 0)"}},{default:o(()=>[...n[324]||(n[324]=[s("快速检索，Kibana 将 Elasticsearch 的数据进行可视化管理",-1)])]),_:1}),n[326]||(n[326]=s("。",-1))])])}const Z=p(g,[["render",O]]),X=JSON.parse('{"path":"/posts/strawberry.html","title":"日志收集平台","lang":"zh-CN","frontmatter":{"icon":"pen-to-square","date":"2022-01-11T00:00:00.000Z","category":["水果","草莓"],"tag":["红","小"],"description":"4c :::tips Apache Kafka（常被称为 \\"卡夫卡\\"）是**的开源分布式流处理平台，最初由 LinkedIn 开发，2011 年捐赠给 Apache 并成为顶级项目，名称取自捷克小说家弗兰兹・卡夫卡（Franz Kafka）。它本质上是一个**，核心定位是 \\"高吞吐量的分布式发布 - 订阅消息系统\\"，同时兼具流处理平台的能力。 ::: ...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"日志收集平台\\",\\"image\\":[\\"https://cdn.nlark.com/yuque/0/2026/jpeg/62301513/1768190486327-e5da738b-7a03-4e14-97f5-3e117ff64b2a.jpeg\\",\\"https://cdn.nlark.com/yuque/0/2026/png/62301513/1768199620419-ffc1dcf0-3472-4799-b41c-17ea31dcfbf2.png\\",\\"https://cdn.nlark.com/yuque/0/2026/png/62301513/1768632458834-b767737e-6598-4959-89ce-216b36a22929.png\\",\\"https://cdn.nlark.com/yuque/0/2026/png/62301513/1768632391859-11d0d459-a745-467e-a74e-53a2fecafab0.png\\",\\"https://cdn.nlark.com/yuque/0/2026/jpeg/62301513/1768206182594-5332137b-4aa5-4935-8f85-38b927b93401.jpeg\\",\\"https://cdn.nlark.com/yuque/0/2026/jpeg/62301513/1768206496384-714b60be-8753-417a-9347-add4ab7765b9.jpeg\\",\\"https://cdn.nlark.com/yuque/0/2026/jpeg/62301513/1768206511355-abe64513-b838-493f-a2c5-0e3cc3c22659.jpeg\\",\\"https://cdn.nlark.com/yuque/0/2026/png/62301513/1768656659078-6082928a-6ed3-46e1-9769-f37f577f6464.png\\",\\"https://cdn.nlark.com/yuque/0/2026/png/62301513/1768656975558-f3dcab85-4b91-4672-9a67-89b627b45efc.png\\",\\"https://cdn.nlark.com/yuque/0/2026/png/62301513/1768656791115-4eb2474f-7d63-4693-8ff8-156d336ed4d2.png\\",\\"https://cdn.nlark.com/yuque/0/2026/png/62301513/1768657703870-9665235c-d1f4-4ed9-9263-5cb9480cffec.png\\",\\"https://cdn.nlark.com/yuque/0/2026/png/62301513/1768658316170-bf215910-cb05-4e70-a3cb-0f3d3c54dda3.png\\",\\"https://cdn.nlark.com/yuque/0/2026/png/62301513/1768658739079-513543e2-e284-4e60-a9b9-d64be0c2273d.png\\",\\"https://cdn.nlark.com/yuque/0/2026/png/62301513/1768805475222-1f1c586e-da7a-493f-939f-bdbb505159dd.png\\",\\"https://cdn.nlark.com/yuque/0/2026/png/62301513/1768805497859-994bc565-a8aa-4fbf-83b4-7f502ae150df.png\\",\\"https://cdn.nlark.com/yuque/0/2026/png/62301513/1768813768064-6ea6f197-4e35-442f-9538-8531def6e6f5.png\\",\\"https://cdn.nlark.com/yuque/0/2026/png/62301513/1768895695889-80cac052-2273-4726-a5bd-68e8d0d1ec31.png\\"],\\"datePublished\\":\\"2022-01-11T00:00:00.000Z\\",\\"dateModified\\":\\"2026-02-13T11:22:18.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"王梓涵\\",\\"url\\":\\"https://mister-hope.com\\"}]}"],["meta",{"property":"og:url","content":"https://mister-hope.github.io/blog/posts/strawberry.html"}],["meta",{"property":"og:site_name","content":"博客blog"}],["meta",{"property":"og:title","content":"日志收集平台"}],["meta",{"property":"og:description","content":"4c :::tips Apache Kafka（常被称为 \\"卡夫卡\\"）是**的开源分布式流处理平台，最初由 LinkedIn 开发，2011 年捐赠给 Apache 并成为顶级项目，名称取自捷克小说家弗兰兹・卡夫卡（Franz Kafka）。它本质上是一个**，核心定位是 \\"高吞吐量的分布式发布 - 订阅消息系统\\"，同时兼具流处理平台的能力。 ::: ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://cdn.nlark.com/yuque/0/2026/jpeg/62301513/1768190486327-e5da738b-7a03-4e14-97f5-3e117ff64b2a.jpeg"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2026-02-13T11:22:18.000Z"}],["meta",{"property":"article:tag","content":"小"}],["meta",{"property":"article:tag","content":"红"}],["meta",{"property":"article:published_time","content":"2022-01-11T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2026-02-13T11:22:18.000Z"}]]},"git":{"createdTime":1770967108000,"updatedTime":1770981738000,"contributors":[{"name":"王梓涵","username":"","email":"914132612@qq.com","commits":2}]},"readingTime":{"minutes":39.22,"words":11767},"filePathRelative":"posts/strawberry.md","excerpt":"<p>4c</p>\\n<p>:::tips<br>\\nApache Kafka（常被称为 \\"卡夫卡\\"）是**<strong>的开源分布式流处理平台，最初由 LinkedIn 开发，2011 年捐赠给 Apache 并成为顶级项目，名称取自捷克小说家弗兰兹・卡夫卡（Franz Kafka）。它本质上是一个</strong>**，核心定位是 \\"高吞吐量的分布式发布 - 订阅消息系统\\"，同时兼具流处理平台的能力。</p>\\n<p>:::</p>\\n<figure><img src=\\"https://cdn.nlark.com/yuque/0/2026/jpeg/62301513/1768190486327-e5da738b-7a03-4e14-97f5-3e117ff64b2a.jpeg\\" alt=\\"画板\\" tabindex=\\"0\\" loading=\\"lazy\\"><figcaption>画板</figcaption></figure>","autoDesc":true}');export{Z as comp,X as data};
